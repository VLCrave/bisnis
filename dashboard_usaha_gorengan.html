<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VLCrave Business Page</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #ff8c00, #ffd700);
      color: #333;
    }
    header {
      text-align: center;
      padding: 15px;
      background-color: rgba(255,255,255,0.2);
      backdrop-filter: blur(6px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    header h1 {
      margin: 0;
      font-size: 1.8rem;
      color: white;
    }
    .container {
      max-width: 800px;
      margin: 20px auto;
      padding: 15px;
      background-color: rgba(255,255,255,0.9);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    h2 {
      color: #ff8c00;
      border-left: 5px solid #ffd700;
      padding-left: 8px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th {
      background: #ff8c00;
      color: white;
    }
    td, th {
      padding: 8px;
      text-align: center;
    }
    button {
      background: #ff8c00;
      color: white;
      border: none;
      padding: 8px 14px;
      margin: 5px 0;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background: #e67600;
    }
    .btn-secondary {
      background: #ffd700;
      color: #333;
    }
    .actions {
      display: flex;
      gap: 5px;
      justify-content: center;
    }
    .summary {
      margin-top: 15px;
      padding: 10px;
      background: #fff8e1;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>

<header>
  <h1>üìä VLCrave Business Page</h1>
</header>

<div class="container">
  <h2>üí∞ Rincian Modal</h2>
  <button onclick="addModal()">+ Tambah Modal</button>
  <table id="modalTable">
    <thead>
      <tr>
        <th>Nama Item</th>
        <th>Nominal</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>üìÜ Rekap Penghasilan</h2>
  <button onclick="addIncome()">+ Tambah Penghasilan</button>
  <table id="incomeTable">
    <thead>
      <tr>
        <th>Tanggal</th>
        <th>Nominal</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="summary">
    <h2>üìà Laporan Laba / Rugi</h2>
    <p><b>Total Modal:</b> Rp <span id="totalModal">0</span></p>
    <p><b>Total Penghasilan:</b> Rp <span id="totalIncome">0</span></p>
    <p><b>Laba/Rugi:</b> Rp <span id="profitLoss">0</span></p>
    <p><b>Persentase Profit:</b> <span id="profitPercent">0</span>%</p>
    <p><b>Net Profit per Hari:</b> Rp <span id="netProfit">0</span></p>
  </div>

  <button onclick="shareWhatsApp()">üì§ Bagikan ke WhatsApp</button>
  <button class="btn-secondary" onclick="exportExcel()">üìÑ Export Excel</button>
</div>

<script>
  let modalList = JSON.parse(localStorage.getItem("modalList")) || [];
  let incomeList = JSON.parse(localStorage.getItem("incomeList")) || [];

  function saveData() {
    localStorage.setItem("modalList", JSON.stringify(modalList));
    localStorage.setItem("incomeList", JSON.stringify(incomeList));
    renderTables();
  }

  function addModal() {
    Swal.fire({
      title: 'Tambah Modal',
      html: '<input id="itemName" class="swal2-input" placeholder="Nama Item">' +
            '<input id="itemPrice" type="number" class="swal2-input" placeholder="Nominal">',
      confirmButtonText: 'Simpan',
      preConfirm: () => {
        const name = document.getElementById("itemName").value;
        const price = parseInt(document.getElementById("itemPrice").value) || 0;
        if (!name || price <= 0) return Swal.showValidationMessage("Lengkapi data!");
        modalList.push({ name, price });
        saveData();
      }
    });
  }

  function editModal(index) {
    Swal.fire({
      title: 'Edit Modal',
      html: `<input id="editName" class="swal2-input" value="${modalList[index].name}">
             <input id="editPrice" type="number" class="swal2-input" value="${modalList[index].price}">`,
      confirmButtonText: 'Update',
      preConfirm: () => {
        const name = document.getElementById("editName").value;
        const price = parseInt(document.getElementById("editPrice").value) || 0;
        modalList[index] = { name, price };
        saveData();
      }
    });
  }

  function deleteModal(index) {
    Swal.fire({
      title: 'Hapus Modal?',
      text: 'Data akan dihapus permanen!',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonText: 'Ya, Hapus',
    }).then((result) => {
      if (result.isConfirmed) {
        modalList.splice(index, 1);
        saveData();
      }
    });
  }

  function addIncome() {
    Swal.fire({
      title: 'Tambah Penghasilan',
      html: '<input id="incomeDate" type="date" class="swal2-input">' +
            '<input id="incomePrice" type="number" class="swal2-input" placeholder="Nominal">',
      confirmButtonText: 'Simpan',
      preConfirm: () => {
        const date = document.getElementById("incomeDate").value;
        const price = parseInt(document.getElementById("incomePrice").value) || 0;
        if (!date || price <= 0) return Swal.showValidationMessage("Lengkapi data!");
        incomeList.push({ date, price });
        saveData();
      }
    });
  }

  function editIncome(index) {
    Swal.fire({
      title: 'Edit Penghasilan',
      html: `<input id="editDate" type="date" class="swal2-input" value="${incomeList[index].date}">
             <input id="editIncome" type="number" class="swal2-input" value="${incomeList[index].price}">`,
      confirmButtonText: 'Update',
      preConfirm: () => {
        incomeList[index].date = document.getElementById("editDate").value;
        incomeList[index].price = parseInt(document.getElementById("editIncome").value);
        saveData();
      }
    });
  }

  function deleteIncome(index) {
    Swal.fire({
      title: 'Hapus Penghasilan?',
      text: 'Data akan dihapus permanen!',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonText: 'Ya, Hapus',
    }).then((result) => {
      if (result.isConfirmed) {
        incomeList.splice(index, 1);
        saveData();
      }
    });
  }

  function renderTables() {
    const modalTable = document.querySelector("#modalTable tbody");
    modalTable.innerHTML = "";
    modalList.forEach((item, i) => {
      modalTable.innerHTML += `
        <tr>
          <td>${item.name}</td>
          <td>Rp ${item.price.toLocaleString()}</td>
          <td class="actions">
            <button onclick="editModal(${i})">‚úèÔ∏è</button>
            <button onclick="deleteModal(${i})">üóëÔ∏è</button>
          </td>
        </tr>`;
    });

    const incomeTable = document.querySelector("#incomeTable tbody");
    incomeTable.innerHTML = "";
    incomeList.forEach((item, i) => {
      incomeTable.innerHTML += `
        <tr>
          <td>${item.date}</td>
          <td>Rp ${item.price.toLocaleString()}</td>
          <td class="actions">
            <button onclick="editIncome(${i})">‚úèÔ∏è</button>
            <button onclick="deleteIncome(${i})">üóëÔ∏è</button>
          </td>
        </tr>`;
    });

    const totalModal = modalList.reduce((sum, x) => sum + x.price, 0);
    const totalIncome = incomeList.reduce((sum, x) => sum + x.price, 0);
    const profitLoss = totalIncome - totalModal;
    const profitPercent = totalModal > 0 ? ((profitLoss / totalModal) * 100).toFixed(2) : 0;
    const netProfit = incomeList.length > 0 ? (profitLoss / incomeList.length).toFixed(0) : 0;

    document.getElementById("totalModal").textContent = totalModal.toLocaleString();
    document.getElementById("totalIncome").textContent = totalIncome.toLocaleString();
    document.getElementById("profitLoss").textContent = profitLoss.toLocaleString();
    document.getElementById("profitPercent").textContent = profitPercent;
    document.getElementById("netProfit").textContent = netProfit;
  }

  function shareWhatsApp() {
    const totalModal = modalList.reduce((sum, x) => sum + x.price, 0);
    const totalIncome = incomeList.reduce((sum, x) => sum + x.price, 0);
    const profitLoss = totalIncome - totalModal;
    const profitPercent = totalModal > 0 ? ((profitLoss / totalModal) * 100).toFixed(2) : 0;

    let message = `*VLCrave Business Page*%0A%0A`;
    message += `üí∞ *Total Modal:* Rp ${totalModal.toLocaleString()}%0A`;
    message += `üìà *Total Penghasilan:* Rp ${totalIncome.toLocaleString()}%0A`;
    message += `üíπ *Laba/Rugi:* Rp ${profitLoss.toLocaleString()}%0A`;
    message += `üìä *Persentase Profit:* ${profitPercent}%`;

    window.open(`https://wa.me/?text=${message}`, "_blank");
  }

  function exportExcel() {
    const ws = XLSX.utils.json_to_sheet([
      ...modalList.map(m => ({ Kategori: "Modal", Nama: m.name, Nominal: m.price })),
      ...incomeList.map(i => ({ Kategori: "Penghasilan", Tanggal: i.date, Nominal: i.price }))
    ]);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Laporan VLCrave");
    XLSX.writeFile(wb, "VLCrave_Business_Report.xlsx");
  }

  renderTables();
</script>

</body>
</html>
